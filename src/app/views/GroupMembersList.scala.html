@import views.bootstrapHelper.enums.ButtonClass
@import bootstrapHelper._

@import scala.collection.JavaConverters._

@import models.dtos.UserIdDto
@import policy.session.SessionManager.SessionInstance
@(group: Group, members: Seq[User], notMembers: Seq[User], addUserForm: Form[UserIdDto], removeGroupUserForm: Form[UserIdDto])

@removeMemberButton(member: User) = {
    @if(policy.Specification.instance.CanRemoveGroupMember(SessionInstance().currentUser(), group, member)) {
        @bootstrapHelper.form(
            routes.GroupController.removeGroupMember(group.getGroupId()),
            removeGroupUserForm,
            scala.collection.Map(
                "userId" -> Input(InputType.Hidden,
                    value = Left(member.getUserId().toString))
            ),
            button = listGroupButton(member.getUsername())
        )
    } else {
        @listGroupButton(member.getUsername(), disabled = true)
    }
}

@addMemberButton() = {
    @if(policy.Specification.instance.CanGenerallyAddGroupMember(SessionInstance().currentUser(), group)) {
        @bootstrapHelper.form(
            routes.GroupController.addGroupMember(group.getGroupId()),
            addUserForm,
            scala.collection.Map(
                "userId" -> Input(InputType.Select,
                    value = Right(notMembers.map(user => user.getUserId().toString -> user.getUsername())),
                    label = "Nutzer waehlen")
            ),
            button = button("Nutzer hinzufuegen")
        )
    }
}

@Main("HsH-Helfer: Detailansicht der Gruppe " + group.getName()) {
    <h1>GRUPPE "@group.getName()"</h1>
    @bootstrapHelper.sidebarPlusContent {
        @bootstrapHelper.card {
            <div class="card-body">
                <h5 class="card-title">Mitglied hinzufuegen</h5>
                <p class="card-text">
                    @addMemberButton()
                </p>
            </div>
            <div class="card-footer">
                <h5>Mitglied entfernen</h5>
            </div>
            @bootstrapHelper.listGroupFlush(
                group.getMembers().asScala.toSeq.map(
                    u => removeMemberButton(u)
                )
            )
        }
    } {
        <h2>Dateien</h2>
        <p>Hier werden sie in Zukunft sehen, welche Dateien fuer diese Gruppe freigeschalten wurden!</p>
        @table(Seq(scala.collection.Map(
            "Name" -> Left("Anstandsregeln.txt"),
            "Kommentar" -> Left("Nur zu Demonstrationszwecken!"),
            "Hochgeladen von" -> Left("admin"),
            "Zugriffsrechte" -> Left("R")
        )))
    }
}