@import views.bootstrapHelper.enums.ButtonClass
@import views.bootstrapHelper.Input
@import views.bootstrapHelper.enums.InputType
@import bootstrapHelper._

@(group: Group, members: Seq[User], notMembers: Seq[User], addUserForm: Form[dtos.AddUserToGroupDTO], removeGroupUserForm: Form[dtos.RemoveGroupUserDTO])

@implicitFieldConstructor = @{ helper.FieldConstructor(BootstrapFieldConstructor.render)}

@userButton(member: User) = {
    @if(policy.Specification.CanRemoveGroupMember(extension.ContextArguments.getUser().get(), group, member)) {
        @bootstrapHelper.form(
            routes.GroupController.postRemoveMember(group.getId()),
            removeGroupUserForm,
            scala.collection.Map(
                "userId" -> Input(InputType.Hidden,
                    value = member.getId().toString)
            ),
            "Entfernen"
        )
    } else {
        @button("Entfernen", clazz = ButtonClass.Secondary)
    }
}

@Main("Mitglieder von: " + group.name) {
    @table(members.map(
        member => scala.collection.Map(
            "Benutzername" -> member.username,
            "" -> userButton(member).toString
    )))

    @if(policy.Specification.isAllowedToAddGroupMember(extension.ContextArguments.getUser().get(),
group)) {
        <h2>Benutzer hinzufuegen</h2>
        @helper.form(action = routes.GroupController.addMember(group.getId())) {
            @helper.CSRF.formField
            @helper.select(
                field = addUserForm("userId"),
                options = notMembers.map(user => user.id.toString -> user.username),
                '_label -> "Nutzer waehlen"
            )
            @button("Nutzer hinzufuegen")
        }
    }
}