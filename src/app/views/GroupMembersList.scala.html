@import views.bootstrapHelper.enums.ButtonClass
@import bootstrapHelper._

@(group: Group, members: Seq[User], notMembers: Seq[User], addUserForm: Form[dtos.AddUserToGroupDTO])

@implicitFieldConstructor = @{ helper.FieldConstructor(BootstrapFieldConstructor.render)}

@userButton(member: User) = {
    @if(policy.Specification.CanRemoveGroupMember(extension.ContextArguments.getUser().get(), group, member)) {
        @helper.form(action = routes.GroupController.postRemoveMember(group.getId())){
            @helper.CSRF.formField
            <input type="hidden" name="userId" value="@member.getId()" />
            @button("Entfernen")
        }
    } else {
        @button("Entfernen", clazz = ButtonClass.Secondary)
    }
}

@Main("Mitglieder von: " + group.name) {
    @table(members.map(
        member => scala.collection.Map(
            "Benutzername" -> member.username,
            "" -> userButton(member).toString
    )))

    @if(policy.Specification.isAllowedToAddGroupMember(extension.ContextArguments.getUser().get(),
group)) {
        <h2>Benutzer hinzufuegen</h2>
        @helper.form(action = routes.GroupController.addMember(group.getId())) {
            @helper.CSRF.formField
            @helper.select(
                field = addUserForm("userId"),
                options = notMembers.map(user => user.id.toString -> user.username),
                '_label -> "Nutzer waehlen"
            )
            @button("Nutzer hinzufuegen")
        }
    }
}