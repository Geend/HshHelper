@import models.dtos.DeleteGroupDto
@import policy.session.SessionManager.SessionInstance
@(groupsFormMap: scala.collection.Map[Group, Form[DeleteGroupDto]])

@import bootstrapHelper._

@viewGroupButton(g: Group) = {
    @if(policy.Specification.instance.CanViewGroupDetails(SessionInstance().currentUser(), g)) {
        @link("Mitglieder bearbeiten", routes.GroupController.showGroup(g.getGroupId()))
    }
}

@deleteGroupButton(g: Group, f: Form[DeleteGroupDto]) = {
    @if(policy.Specification.instance.CanDeleteGroup(SessionInstance().currentUser(), g)) {
        @bootstrapHelper.form(
            routes.GroupController.deleteOwnGroup(g.getGroupId()),
            f,
            scala.collection.Map(
                "groupId" -> Input(InputType.Hidden)
            ),
            button = bootstrapHelper.button("Gruppe loeschen")
        )
    }
}

@Main("Eigene Gruppen") {
        <div class="container-fluid">
            <div class="row justify-content-between">
                <div class="col-auto mr-auto">
                    <h2>Eigene Gruppen</h2>
                </div>
                <div class="col-auto">
                    @link("Eine neue Gruppe anlegen", routes.GroupController.showCreateGroupForm())
                </div>
            </div>
        </div>
        <div class="container-fluid" role="main">
            <div class="row flex-xl-row">
                <div class="col px-3 py-3 bd-content col-align-self-center">
                @table(groupsFormMap
                        .filter{
                            case (k, v) => k.getOwner() == SessionInstance().currentUser()
                        }
                        .map{ case (k, v) => scala.collection.Map(
                                "Gruppenname" -> Left(k.getName()),
                                "Gruppenmitglieder anschauen" -> Right(viewGroupButton(k)),
                                "Gruppe loeschen" -> Right(deleteGroupButton(k, v))
                            )}
                        .toSeq
                )
                </div>
            </div>
        </div>
        <hr>
        <div class="container-fluid" role="main">
            <div class="row justify-content-between">
                <div class="col-sm">
                    <h2>Mitglied folgender Gruppen</h2>
                </div>
            </div>
            <div class="row flex-xl-row">
                <div class="col px-3 py-3 bd-content col-align-self-center">
                @table(groupsFormMap
                        .filter{
                            case (k, v) => k.getOwner() != SessionInstance().currentUser()
                        }
                        .map{ case (k, v) => scala.collection.Map(
                                "Gruppenname" -> Left(k.getName()),
                                "Gruppenmitglieder anschauen" -> Right(viewGroupButton(k)),
                                "Gruppe loeschen" -> Right(deleteGroupButton(k, v))
                            )}
                        .toSeq
                )
                </div>
            </div>
        </div>
}
