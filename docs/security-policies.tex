% arara: pdflatex: { shell: true, draft: true }
% arara: makeglossaries
% arara: biber
% arara: pdflatex: { shell: true, synctex: true }
% arara: pdflatex: { shell: true, synctex: true }

\documentclass[12pt,DIV14,BCOR10mm,a4paper,parskip=half-,english,ngerman,bibliography=totocnumbered]{scrreprt}
% Grundgröße 12pt, zweiseitig
\usepackage[headsepline,automark]{scrpage2}
\KOMAoptions{headinclude}
% Seitenköpfe automatisch
% Sprachpaket für Deutsch (Umlaute, Trennung,deutsche Überschriften)
\usepackage{babel}
\usepackage{blindtext}
%Graphikeinbindung, Hyperref (alles klickbar, Bookmarks),
%Math. Symbole aus AmsTeX
\usepackage{graphicx,hyperref,amssymb,url,atbegshi,etoolbox}

\usepackage[backend=biber,natbib=true, style=numeric, citestyle=numeric, maxnames=7, minnames=1, maxcitenames=2, url=true]{biblatex}
% Umlaute und über Tastatur einzugeben
\usepackage[utf8]{inputenc}
% add table of contents and other tables automatically
\usepackage[nottoc]{tocbibind}
%\usepackage[toc,page]{appendix}

\usepackage[autostyle=true,german=quotes]{csquotes}
%% json related packages
% dont use bera, can't get it at the work PC
%\usepackage{bera} % optional: just to have a nice mono-spaced font
\usepackage{listings}
\usepackage{xcolor}
\usepackage{textcomp}
\usepackage{tabularx}
\usepackage{pifont}

\definecolor{hsh-f4-orange}{rgb}{0.862745098, 0.235294118, 0.019607843}

\usepackage{xcolor}
\hypersetup{
    colorlinks,
    linkcolor={hsh-f4-orange},
    citecolor={hsh-f4-orange},
    urlcolor={blue!80!black}
}

%%% Change settings for epigraphs
%%% Change chapter format, if needed.
% customize chapter format:
% \KOMAoption{headings}{twolinechapter}
% \renewcommand*\chapterformat{\thechapter\autodot}

% customize dictum format:
\setkomafont{dictumtext}{\itshape\small}
\setkomafont{dictumauthor}{\normalfont}
\renewcommand*\dictumwidth{\linewidth}
\renewcommand*\dictumauthorformat[1]{--- #1}
\renewcommand*\dictumrule{}

\renewcommand{\lstlistingname}{Quellcode}

\makeatletter
\makeatother

% create glossaries
\usepackage[toc,section=chapter,nopostdot,acronym,style=list]{glossaries}
% style & idea copied from: https://tex.stackexchange.com/questions/8946/how-to-combine-acronym-and-glossary
\usepackage{xparse}
\DeclareDocumentCommand{\newdualentry}{ O{} O{} m m m m } {

  %%% The glossary entry the acronym links to
  \newglossaryentry{g-#3}{name={#5},
      description={#6},#1}

  %%% define the acronym and use the see= option
  \newglossaryentry{#3}{type=\acronymtype, name={#4}, description={#5}, first={#5 (#4)\glsadd{g-#3}}, see=[Glossareintrag:]{g-#3}}
}

\makeglossaries

\loadglsentries[main]{acronyms.tex}

% Festlegung Kopf- und Fußzeile
\defpagestyle{meinstil}{%
{\headmark \hfill}
{\hfill \headmark}
{\hfill \headmark\hfill }
(\textwidth,.4pt)
}{%
(\textwidth,.4pt)
{\pagemark\hfill Dennis Grabowski, Julius Zint, Philip Matesanz, Torben Voltmer}
{Version 1.0 vom \today \hfill \pagemark}
{Version 1.0 vom \today\hfill\pagemark}
}
\pagestyle{meinstil}

\raggedbottom
\renewcommand{\topfraction}{1}
\renewcommand{\bottomfraction}{1}

\bibliography{literature.bib}
\graphicspath{{./images/}}

\newcommand{\greencheckmark}{\textcolor{green}{\ding{51}}}%
\newcommand{\redxmark}{\textcolor{red}{\ding{55}}}%

\makeatletter
\patchcmd{\scr@startchapter}{\if@openright\cleardoublepage\else\clearpage\fi}{}{}{}
\makeatother

\pagestyle{plain}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}    % hier gehts los
  \thispagestyle{empty} % Titelseite
\includegraphics[width=0.2\textwidth]{Wortmarke_WI_schwarz}

   {  ~ \sffamily
  \vfill
  {\Huge\bfseries Sicherheitsrichtlinien}
  \bigskip

  {\Large
  Dennis Grabowski, Julius Zint, Philip Matesanz, Torben Voltmer \\[2ex]
  Masterprojekt \\
  \enquote{Entwicklung und Analyse einer sicheren Web-Anwendung} \\
  Wintersemester 18/19\makeatletter
  \patchcmd{\scr@startchapter}{\if@openright\cleardoublepage\else\clearpage\fi}{}{}{}
  \makeatother
 \\[5ex]
   \today }
}
 \vfill

  ~ \hfill
  \includegraphics[height=0.3\paperheight]{H_WI_Pantone1665}

\vspace*{-3cm}

\clearpage

\tableofcontents  % Inhaltsverzeichnis

\clearpage

\chapter{Annahmen}

\begin{itemize}
  \item Netzwerkverbindungen sind abhörsicher und von außen nicht beeinflussbar.
  \item Betriebssystem, Hardware sowie verwendetete Bibliotheken enthalten keine sicherheitsrelevanten Fehler.
  \item Hashing-Algorithmus \enquote{bcrypt} macht es einem Angreifer wirtschaftlich unmöglich, Passwörter durch Brute-Force oder Rainbow Tables herauszufinden.
  \item Lösen eines Captchas ist für einen Angreifer wirtschaftlich undurchführbar.
  \item Bibliotheksfunktion \texttt{java.security.SecureRandom} \autocite{JavaDocs.SecureRandom} erstellt Zufallszahlen, die kryptografisch sicher sind.
  \item Einstellung \texttt{ALLOW\_LITERALS} der Datenbank \enquote{h2} verhindert SQL-Injections.
  \item \enquote{\gls{jwt}}-Format ist kryptografisch sicher zur Speicherung von Session- sowie Cookie-Daten.
  \item Applikation kann nur über die definierten Eintrittspunkte verwendet werden.
  \item Benutzer des HsH-Helfers verraten nicht ihr Passwort an andere.
  \item Initialer Benutzer \enquote{admin} ist vertrauenswürdig.
  \item Autogenerierte IDs der Datenbank \enquote{h2} sind aufsteigend und werden nicht wiederverwendet, sofern eine ID wieder frei wird.
\end{itemize}

\chapter{Akteur}

\begin{itemize}
  \item Administratoren (A)
  \item Gruppenbesitzer (GO)
  \item Gruppenmitglied (GM)
  \item Authentisierter Benutzer (U+)
  \item Unauthentisierter Benutzer (U-)
  \item E-Mail Server (EM)
  \item \textcolor{red}{Google Recaptcha}
\end{itemize}

\chapter{Eintrittspunkte}

\begin{itemize}
  \item Netzwerkschnittstellen
  \begin{itemize}
    \item HTTP (Port 80)  [U-, U+, GM, GO, A]
    \item SMTP (Port 587) [U-]
    \item Konfigurationsdatei
  \end{itemize}
\end{itemize}

\chapter{Assets}

\begin{itemize}
  \item Benutzeranmeldeinformationen
  \begin{itemize}
    \item Passwort [-]
    \item Session [U+, GM, GO, A]
  \end{itemize}
  \item Privater Schlüssel zur Generation des JWT/der Sessions [-]
  \item Privater Schlüssel zur Validierung der Captchas [-]
  \item Gruppen [U+, GM, GO, A]
  \item Nutzerkonto [A]
\end{itemize}

\chapter{Aktionen}

\begin{itemize}
  \item \textbf{AK1:} Einloggen [U-]
  \item \textbf{AK2:} Ausloggen [U+, GM, GO, A]
  \item \textbf{AK3:} Nutzer erstellen [A]
  \item \textbf{AK4:} Nutzer löschen [A]
  \item \textbf{AK5:} Passwort zurücksetzen lassen [U-, EM]
  \item \textbf{AK6:} Passwort nach Zurücksetzung anpassen [U+, GM, GO, A]
  \item \textbf{AK7:} Aktive Sessions anzeigen lassen [U+, GM, GO, A]
  \item \textbf{AK8:} Aktive Sessions zerstören [U+, GM, GO, A]
  \item \textbf{AK9:} Gruppe erstellen [U+, GM, GO, A]
  \item \textbf{AK10:} Gruppe löschen [GO, A]
  \item \textbf{AK11:} Nutzer zu einer Gruppe hinzufügen [GO, A]
  \item \textbf{AK12:} Nutzer aus einer Gruppe löschen [GO, A]
  \item \textbf{AK13:} Gruppen anzeigen lassen [U+, GM, GO, A]
  \item \textbf{AK14:} Mitglieder einer Gruppe sehen [GM, GO, A]
\end{itemize}

\chapter{Richtlinien}

\newcolumntype{Y}{>{\centering\arraybackslash}X}

% htbp = HereTopBottomPage (priority of where to place the table in case previous placement fails)
\begin{table}[ht]
  \begin{tabularx}{\textwidth}{| l | Y | Y | Y | Y |}
      \hline
      Aktion     & Administrator     & Gruppenbesitzer & Gruppenmitglied & Nutzer     \\ \hline
      AK1        & \redxmark & \redxmark & \redxmark & \redxmark \\ \hline
      AK2        & \greencheckmark & \greencheckmark  & \greencheckmark & \greencheckmark \\ \hline
      AK3        & \greencheckmark & \redxmark & \redxmark & \redxmark \\ \hline
      AK4        & \greencheckmark & \redxmark & \redxmark & \redxmark \\ \hline
      AK5        & \redxmark & \redxmark & \redxmark & \redxmark \\ \hline
      AK6        & \greencheckmark & \greencheckmark  & \greencheckmark & \greencheckmark \\ \hline
      AK7        & \greencheckmark & \greencheckmark  & \greencheckmark & \greencheckmark \\ \hline
      AK8        & \greencheckmark & \greencheckmark  & \greencheckmark & \greencheckmark \\ \hline
      AK9        & \greencheckmark & \greencheckmark  & \greencheckmark & \greencheckmark \\ \hline
      AK10        & \greencheckmark & \greencheckmark  & \redxmark & \redxmark \\ \hline
      AK11        & \greencheckmark & \greencheckmark  & \redxmark & \redxmark \\ \hline
      AK12        & \greencheckmark & \greencheckmark  & \redxmark & \redxmark \\ \hline
      AK13       & \greencheckmark & \greencheckmark  & \greencheckmark & \greencheckmark \\ \hline
      AK14       & \greencheckmark & \greencheckmark  & \greencheckmark & \redxmark \\ \hline
  \end{tabularx}
\end{table}

\begin{itemize}
  \item Nutzer können nur mit dem System interagieren, wenn sie authentisiert sind.
  \item Nutzer können nur Gruppen sehen, dessen Mitglied sie sind.
  \item Ausschliesslich Administratoren können alle Gruppen sehen.
  \item Nutzer dürfen nur Mitglieder einer Gruppe hinzufügen, wenn sie der Besitzer dieser Gruppe sind.
  \item Ausschliesslich Administratoren können Mitglieder zu allen Gruppen hinzufügen.
  \item Nutzer dürfen nur Mitglieder aus einer Gruppe entfernen, wenn sie der Besitzer dieser Gruppe sind.
  \item Ausschliesslich Administratoren können Mitglieder (aber nicht den Besitzer) aus allen Gruppen entfernen.
  \item Kein Nutzer, auch nicht Administratoren, kann die Sessions anderer Nutzer betrachten oder zerstören.
  \item Passwörter der Nutzer können von keiner Person ausgelesen werden.
  \item Ein Administrator hat nur schreibenden Zugriff auf ein Nutzerkonto beim Löschen. Ihm ist nicht möglich, andere Informationen aus dem Nutzerkonto zu lesen.
\end{itemize}

\clearpage

\printbibliography

% Can be used to add a list of acronyms with their description
% \glsaddall
%\deftranslation{to=German}{Acronyms}{Abkürzungsverzeichnis}
%\deftranslation{to=German}{Glossary}{Glossar}
\printacronyms[title=Abkürzungsverzeichnis,toctitle=Abkürzungsverzeichnis]
\printglossary[type=main]

%s\addcontentsline{toc}{chapter}{\listtablename}
% \listoftables       % Tabellenverzeichnis

\end{document}
